if ("undefined" == typeof jQuery) throw new Error("trackswitchjs's JavaScript requires jQuery.");
!function(a){var b=a.fn.jquery.split(" ")[0].split(".");if (b[0] < 2 && b[1] < 9 || 1 == b[0] && 9 == b[1] && b[2] < 1 || b[0] >= 4) throw new Error("trackswitchjs's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}(jQuery), function() {
    function a(a, e) {
        this.element = $(a), this.options = $.extend({}, d, e), this.numberOfTracks = 0, this.longestDuration = 0, this.playing = !1, this.position = 0, this.trackProperties = [], this.trackSources = [], this.trackBuffer = [], b && (this.gainNodeMaster = b.createGain(), this.gainNodeMaster.gain.value = 0, this.gainNodeMaster.connect(b.destination)), this.init()
    }
    var b = function() {
        return "undefined" != typeof AudioContext ? new AudioContext : "undefined" != typeof webkitAudioContext ? new webkitAudioContext : null
    }(),
    c = "trackSwitch",
    d = {};
    a.prototype.init = function() {
        var a = this;
        this.element.addClass("jquery-trackswitch"),
        0 === this.element.find(".main-control").length && this.element.prepend('<div class="main-control"><ul class="control"><li class="playpause button">Play</li><li class="timing"><span class="time">--:--</span> / <span class="length">--:--</span></li></ul></div>'),
        this.element.on("touchstart mousedown", ".playpause", $.proxy(this.event_playpause, this)),
        this.element.one("loaded", $.proxy(this.loaded, this)),
        this.element.one("errored", $.proxy(this.errored, this));
        this.numberOfTracks = this.element.find("ts-track").length, this.updateMainControls()
    },
    a.prototype.updateMainControls = function() {
        this.element.find(".playpause").toggleClass("checked", this.playing);
        0 !== this.longestDuration && ($(this.element).find('.timing .time').html(this.secondsToHHMMSS(this.position)), $(this.element).find('.timing .length').html(this.secondsToHHMMSS(this.longestDuration)))
    },
    a.prototype.secondsToHHMMSS = function(a) {
        var b = Math.floor(a / 60), c = Math.floor(a % 60);
        return (b < 10 ? "0" + b : b) + ":" + (c < 10 ? "0" + c : c)
    },
    a.prototype.monitorPosition = function(a) {
        a.position = a.playing ? b.currentTime - a.startTime : a.position, a.updateMainControls()
    },
    a.prototype.startAudio = function() {
        this.playing = !0, this.updateMainControls()
    },
    a.prototype.pause = function() {
        this.playing = !1, this.updateMainControls()
    },
    a.prototype.event_playpause = function(a) {
        a.preventDefault(), this.playing ? this.pause() : this.startAudio(), a.stopPropagation()
    },
    $.fn[c] = function(b) {
        return this.each(function() {
            $(this).data("plugin_" + c) || $(this).data("plugin_" + c, new a(this, b))
        })
    }
}();
